
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1. Lecture 1 Introduction to Finite Differences &#8212; Numerical Methods for Partial Differential Equations</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css?v=b4b7a797" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/FiniteDiffLecture1';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Numerical Methods for PDEs" href="../intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Numerical Methods for Partial Differential Equations - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Numerical Methods for Partial Differential Equations - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Numerical Methods for PDEs
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">1. Lecture 1 Introduction to Finite Differences</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/joelmiller/FiniteDiff/master?urlpath=tree/docs/notebooks/FiniteDiffLecture1.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/joelmiller/FiniteDiff" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/joelmiller/FiniteDiff/issues/new?title=Issue%20on%20page%20%2Fnotebooks/FiniteDiffLecture1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/FiniteDiffLecture1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 1 Introduction to Finite Differences</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretizing-space">1.1. Discretizing space</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-differences">1.2. Finite Differences</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-difference-approximations-for-the-first-derivative">1.2.1. Finite Difference Approximations for the First derivative</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-difference">1.2.1.1. Forward difference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-difference">1.2.1.2. Backward Difference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#central-difference">1.2.1.3. Central difference</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-difference-approximations-for-the-second-derivative">1.2.2. Finite Difference Approximations for the Second derivative</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#returning-to-the-pde">1.3. Returning to the PDE</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practice-problems">1.4. Practice Problems</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lecture-1-introduction-to-finite-differences">
<h1><span class="section-number">1. </span>Lecture 1 Introduction to Finite Differences<a class="headerlink" href="#lecture-1-introduction-to-finite-differences" title="Link to this heading">#</a></h1>
<p>We will build this lecture around the example PDE</p>
<div class="math notranslate nohighlight">
\[
u_t(x,t) = K u_{xx}(x,t)
\]</div>
<p>Our goal will be to find an approximate solution to this PDE.
We will use the initial condition</p>
<div class="math notranslate nohighlight">
\[
u(x,0) = g(x) = \frac{100x}{L} + 100\sin\left(\frac{4\pi x}{L}\right)
\]</div>
<p>and boundary conditions</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
u(0,t) &amp;= 0\\
u(L,t) &amp;= 100 
\end{align*}\]</div>
<p>When we need to use specific values, we will take <span class="math notranslate nohighlight">\(K=0.01\)</span> and <span class="math notranslate nohighlight">\(L=5\)</span>.</p>
<section id="discretizing-space">
<h2><span class="section-number">1.1. </span>Discretizing space<a class="headerlink" href="#discretizing-space" title="Link to this heading">#</a></h2>
<p>We will attempt to find the values</p>
<div class="math notranslate nohighlight">
\[
u_i^j \equiv u(x_i,t_j)
\]</div>
<p>for discrete values <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(t_j\)</span> with</p>
<div class="math notranslate nohighlight">
\[
x_i = i \Delta x , \qquad i = 0,1,\ldots, N
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[t_j = j \Delta t, \qquad j = 0, 1,\ldots
\]</div>
<p>We set <span class="math notranslate nohighlight">\(\Delta x = L/N\)</span> so that there are <span class="math notranslate nohighlight">\(N+1\)</span> values and <span class="math notranslate nohighlight">\(x_N=L\)</span>.</p>
<p>To do this we will use finite differences in order to express the derivatives in the PDE in terms of the different values <span class="math notranslate nohighlight">\(u_j^i\)</span>.</p>
</section>
<section id="finite-differences">
<h2><span class="section-number">1.2. </span>Finite Differences<a class="headerlink" href="#finite-differences" title="Link to this heading">#</a></h2>
<p>We will focus on finite differences in one dimension.  We will take a function <span class="math notranslate nohighlight">\(f(x)\)</span>, and discretize it to have values at a sequence of <span class="math notranslate nohighlight">\(x\)</span> values <span class="math notranslate nohighlight">\(\ldots, x_{i-1}, x_i, x_{i+1}, \ldots\)</span>.</p>
<p>To set things a bit more formal, we will assume that <span class="math notranslate nohighlight">\(f\)</span> is smooth.  This means that we can differentiate it as many times as we will need in our calculations below and the derivatives are continuous.</p>
<p>We define</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
F_{i+1} &amp;= f(x_{i+1})\\
F_i &amp;= f(x_i)\\
F_{i-1} &amp;= f(x_{i-1})
\end{align*}\]</div>
<p>We will want to work out approximations to</p>
<div class="math notranslate nohighlight">
\[
F_i' = f'(x_i)
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
F_i'' = f''(x_i)
\]</div>
<p>in terms of <span class="math notranslate nohighlight">\(F_{i+1}\)</span>, <span class="math notranslate nohighlight">\(F_i\)</span>, and <span class="math notranslate nohighlight">\(F_{i-1}\)</span>.</p>
<section id="finite-difference-approximations-for-the-first-derivative">
<h3><span class="section-number">1.2.1. </span>Finite Difference Approximations for the First derivative<a class="headerlink" href="#finite-difference-approximations-for-the-first-derivative" title="Link to this heading">#</a></h3>
<section id="forward-difference">
<h4><span class="section-number">1.2.1.1. </span>Forward difference<a class="headerlink" href="#forward-difference" title="Link to this heading">#</a></h4>
<p>The definition of the derivative</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
F_i' \equiv f'(x_i) &amp;= \lim_{\Delta x \to 0} \frac{f(x_i+\Delta x) - f(x_i)}{\Delta x}\\
&amp;= \lim_{\Delta x \to 0} \frac{F_{i+1}-F_i}{\Delta x}
\end{align*}\]</div>
<p>suggests that a good approximation would be</p>
<div class="math notranslate nohighlight" id="equation-forward-diff">
<span class="eqno">(1.1)<a class="headerlink" href="#equation-forward-diff" title="Link to this equation">#</a></span>\[
F_i' \approx D_+(f(x_i)) \equiv \frac{F_{i+1} - F_i}{\Delta x}
\]</div>
<p>where <span class="math notranslate nohighlight">\(D_+\)</span> gives the <strong>forward difference</strong> approximation to <span class="math notranslate nohighlight">\(F_i'\)</span>.</p>
<p>We explore this in calculations below for the function <span class="math notranslate nohighlight">\(f(x)= x^2+x^3\)</span>, using <span class="math notranslate nohighlight">\(x_i=1\)</span> and <span class="math notranslate nohighlight">\(\Delta x = 0.5\)</span>.</p>
<p>Look at the graphs generated by the calculations below.  Rerun the calculations with other values of  <code class="docutils literal notranslate"><span class="pre">dx</span></code> to confirm that as <code class="docutils literal notranslate"><span class="pre">dx</span></code> decreases this slope approaches the correct slope.  You can also change the function it uses.</p>
<p>Geometrically, we see that near <span class="math notranslate nohighlight">\(x_i\)</span>, the curve is nearly parallel to the tangent: the tangent lies almost on top of the curve. So if we have <span class="math notranslate nohighlight">\(\Delta x\)</span> small enough that <span class="math notranslate nohighlight">\(x_{i+1}\)</span> fits in the region where the curve and the tangent overlap, then we will have a very good approximation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1">#if you change this function, you also need to change true_derivative below.</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.5</span>


<span class="c1">#the three points x_{i-1}, x_i, x_{i+1}</span>
<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">dx</span><span class="p">])</span>
<span class="n">f_vals</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>  <span class="c1"># F_{i-1}, F_i, F_{i+1}</span>


<span class="n">true_derivative</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1">#true value of f&#39;(x_i)</span>
<span class="n">tangent</span> <span class="o">=</span> <span class="n">true_derivative</span><span class="o">*</span><span class="p">(</span><span class="n">x_vals</span> <span class="o">-</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">f_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">forward_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">f_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">dx</span>  <span class="c1">#the approximate derivative</span>
<span class="n">approx</span> <span class="o">=</span> <span class="n">forward_diff</span><span class="o">*</span><span class="p">(</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">x_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">f_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">#the approximate tangent line</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">f_vals</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">tangent</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Tangent at $x_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">approx</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forward Difference Approximation&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">tangent</span><span class="p">),</span> <span class="n">f_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">+</span> <span class="p">[</span><span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;$x_{i-1}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$x_i$&#39;</span><span class="p">,</span> <span class="s1">&#39;$x_{i+1}$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x2a9d67447d0&gt;
</pre></div>
</div>
<img alt="../_images/d6a86ec5da9a5c0aef18ffea20f96837fdb369e909a63634b2e8b0a64100aa3d.png" src="../_images/d6a86ec5da9a5c0aef18ffea20f96837fdb369e909a63634b2e8b0a64100aa3d.png" />
</div>
</div>
<p>We can estimate the error in the forward difference approximation <span class="math notranslate nohighlight">\(D_+(f(x_i))\)</span> algebraically with the Taylor Series expanded about <span class="math notranslate nohighlight">\(x_i\)</span>:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
F_{i+1} &amp;= F_i + (\Delta x) F_i' + \frac{(\Delta x)^2}{2} F_i'' + \cdots \\
F_i &amp;= F_i
\end{align*}\]</div>
<p>So</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
D_+(f(x_i)) &amp;= \frac{F_{i+1}-F_i}{\Delta x}\\
&amp;= \frac{(\Delta x) F_i' + \frac{(\Delta x)^2}{2} F_i'' + \cdots}{\Delta x}\\
&amp;= F_i' + \mathcal{O}(\Delta x)
\end{align*}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{O}(\Delta x)\)</span> means a neglected term that is order <span class="math notranslate nohighlight">\(\Delta x\)</span>.  We call such an approximation <strong>First Order Accurate</strong>.</p>
</section>
<section id="backward-difference">
<h4><span class="section-number">1.2.1.2. </span>Backward Difference<a class="headerlink" href="#backward-difference" title="Link to this heading">#</a></h4>
<p>We observed that if <span class="math notranslate nohighlight">\(x_{i+1}\)</span> is close enough to <span class="math notranslate nohighlight">\(x_i\)</span>, then the line joining the points at <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(x_{i+1}\)</span> will basically overlap with the tangent curve, and so for small enough <span class="math notranslate nohighlight">\(\Delta x\)</span>, the slope of this line approximates the derivative well.</p>
<p>This also applies for <span class="math notranslate nohighlight">\(x_{i-1}\)</span>.  So we expect the <strong>backwards difference</strong></p>
<div class="math notranslate nohighlight" id="equation-backward-diff">
<span class="eqno">(1.2)<a class="headerlink" href="#equation-backward-diff" title="Link to this equation">#</a></span>\[
D_-(f(x_i)) = \frac{F_i - F_{i-1}}{\Delta x}
\]</div>
<p>to also be a good approximation to <span class="math notranslate nohighlight">\(F_i'\)</span></p>
<p>As a <strong>self-test</strong>, please write out the Taylor Series expansion of <span class="math notranslate nohighlight">\(F_{i-1}\)</span> and use it to estimate the error in the backwards difference approximation.  The method should resemble the process for the forward difference, with some changes due to the <span class="math notranslate nohighlight">\(x\)</span>-shift from <span class="math notranslate nohighlight">\(x_i\)</span> being negative.</p>
<p>You should confirm that the backwards difference is <strong>First Order Accurate</strong>.</p>
<p>Again, you can run the calculations below and change <code class="docutils literal notranslate"><span class="pre">dx</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1">#if you change this function, you also need to change true_derivative below.</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.5</span>


<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">dx</span><span class="p">])</span>
<span class="n">f_vals</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>

<span class="n">true_derivative</span><span class="o">=</span><span class="mi">5</span>
<span class="n">tangent</span> <span class="o">=</span> <span class="n">true_derivative</span><span class="o">*</span><span class="p">(</span><span class="n">x_vals</span> <span class="o">-</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">f_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">backward_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">f_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">dx</span>
<span class="n">approx</span> <span class="o">=</span> <span class="n">backward_diff</span><span class="o">*</span><span class="p">(</span><span class="n">x_vals</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">f_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">f_vals</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">tangent</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Tangent at $x_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">approx</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Backwards Approximation&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">tangent</span><span class="p">),</span> <span class="n">f_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">+</span> <span class="p">[</span><span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;$x_{i-1}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$x_i$&#39;</span><span class="p">,</span> <span class="s1">&#39;$x_{i+1}$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x2a9d8c3b110&gt;
</pre></div>
</div>
<img alt="../_images/000f2b07623d4487fc05ff4c4e4c618898a8dc5e650636d17c71821c261fcae3.png" src="../_images/000f2b07623d4487fc05ff4c4e4c618898a8dc5e650636d17c71821c261fcae3.png" />
</div>
</div>
</section>
<section id="central-difference">
<h4><span class="section-number">1.2.1.3. </span>Central difference<a class="headerlink" href="#central-difference" title="Link to this heading">#</a></h4>
<p>A common theme in Finite Differences is that using formulae that are symmetric about the desired point gives a better approximation.  In a moment you will see an example.  The key detail is that the error on different sides may cancel.  Let’s make this precise.</p>
<p>If we use</p>
<div class="math notranslate nohighlight">
\[
D_0(f(x_i)) = \frac{F_{i+1}-F_{i-1}}{2\Delta x}
\]</div>
<p>then substituting in the Taylor Series we use</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
F_{i+1} &amp;= F_i + (\Delta x) F_i' + \frac{(\Delta x)^2}{2} F_i'' + \frac{(\Delta x)^3}{6} + \cdots\\
F_{i-1} &amp;= F_i - (\Delta x) F_i' + \frac{(\Delta x)^2}{2} F_i'' - \frac{(\Delta x)^3}{6} + \cdots
\end{align*}\]</div>
<p>When we subtract <span class="math notranslate nohighlight">\(F_{i-1}\)</span> from <span class="math notranslate nohighlight">\(F_{i+1}\)</span> all of the even terms cancel.  We are left</p>
<div class="math notranslate nohighlight">
\[\begin{split}
F_{i+1} - F_{i-1} = 2(\Delta x)F_i' + \frac{(\Delta x)^3}{3} F_i''' + \cdots\\
\end{split}\]</div>
<p>Simplifying we get</p>
<div class="math notranslate nohighlight" id="equation-central-diff">
<span class="eqno">(1.3)<a class="headerlink" href="#equation-central-diff" title="Link to this equation">#</a></span>\[
\frac{F_{i+1}-F_{i-1}}{2\Delta x}= F_i' + \mathcal{O}((\Delta x)^2)
\]</div>
<p>So the Central Difference approximation is <strong>Second Order Accurate</strong></p>
<p>As a <strong>self-test</strong> confirm that <span class="math notranslate nohighlight">\(D_0(f(x_i))\)</span> is the average of <span class="math notranslate nohighlight">\(D_+(f(x_i))\)</span> and <span class="math notranslate nohighlight">\(D_-(f(x_i))\)</span>.  Also check that the leading error terms in <span class="math notranslate nohighlight">\(D_+\)</span> and <span class="math notranslate nohighlight">\(D_-\)</span> are equal in magnitude but in opposite directions and so taking the average allows the error to cancel.</p>
<p>Again, you can run the code with different values of <code class="docutils literal notranslate"><span class="pre">dx</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1">#if you change this function, you also need to change true_derivative below.</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.5</span>


<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">dx</span><span class="p">])</span>
<span class="n">f_vals</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>

<span class="n">true_derivative</span><span class="o">=</span><span class="mi">5</span>
<span class="n">tangent</span> <span class="o">=</span> <span class="n">true_derivative</span><span class="o">*</span><span class="p">(</span><span class="n">x_vals</span> <span class="o">-</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">f_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">central_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">f_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
    
<span class="n">approx</span> <span class="o">=</span> <span class="n">central_diff</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">])</span> <span class="o">+</span> <span class="n">f_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">f_vals</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">tangent</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Tangent at $x_i$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">approx</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Central Difference Approximation&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">tangent</span><span class="p">),</span> <span class="n">f_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span><span class="o">+</span> <span class="p">[</span><span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;$x_{i-1}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$x_i$&#39;</span><span class="p">,</span> <span class="s1">&#39;$x_{i+1}$&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x2a9d8ca8410&gt;
</pre></div>
</div>
<img alt="../_images/ac1080cf92930d55735349e75126d5063b735591c69906086116c59c4e9bb8d1.png" src="../_images/ac1080cf92930d55735349e75126d5063b735591c69906086116c59c4e9bb8d1.png" />
</div>
</div>
<p>The increased accuracy is a big deal. The plot below compares the error in calculating <span class="math notranslate nohighlight">\(F_i'\)</span> using forward difference and central difference.</p>
<p>To get a given small level of error, we can use a much larger step size with the central difference, by orders of magnitude.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1">#if you change this function, you also need to change true_derivative below.</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>

<span class="n">true_derivative</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">x_next</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">dx</span>  <span class="c1">#possible values of x_{i+1}</span>
<span class="n">F_next</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_next</span><span class="p">)</span>

<span class="n">x_prev</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">dx</span>
<span class="n">F_prev</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_prev</span><span class="p">)</span>

<span class="n">forward_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="n">F_next</span> <span class="o">-</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span><span class="o">/</span><span class="n">dx</span>
<span class="n">central_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="n">F_next</span> <span class="o">-</span> <span class="n">F_prev</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forward_derivative</span> <span class="o">-</span> <span class="n">true_derivative</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forward Difference Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">central_derivative</span> <span class="o">-</span> <span class="n">true_derivative</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Central Difference Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Step Size $\Delta x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error in Approximation &#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Error in Numerical Derivative of $df(1)/dx$ for given $\Delta x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:25: SyntaxWarning: invalid escape sequence &#39;\D&#39;
&lt;&gt;:27: SyntaxWarning: invalid escape sequence &#39;\D&#39;
&lt;&gt;:25: SyntaxWarning: invalid escape sequence &#39;\D&#39;
&lt;&gt;:27: SyntaxWarning: invalid escape sequence &#39;\D&#39;
C:\Users\JCMiller\AppData\Local\Temp\ipykernel_27984\2613126868.py:25: SyntaxWarning: invalid escape sequence &#39;\D&#39;
  plt.xlabel(&#39;Step Size $\Delta x$&#39;)
C:\Users\JCMiller\AppData\Local\Temp\ipykernel_27984\2613126868.py:27: SyntaxWarning: invalid escape sequence &#39;\D&#39;
  plt.title(&#39;Error in Numerical Derivative of $df(1)/dx$ for given $\Delta x$&#39;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x2a9f6f02990&gt;
</pre></div>
</div>
<img alt="../_images/13f90527ed4291701e3d51ee3f0905e6b913348faf36ce7f72b022668a5e5631.png" src="../_images/13f90527ed4291701e3d51ee3f0905e6b913348faf36ce7f72b022668a5e5631.png" />
</div>
</div>
</section>
</section>
<section id="finite-difference-approximations-for-the-second-derivative">
<h3><span class="section-number">1.2.2. </span>Finite Difference Approximations for the Second derivative<a class="headerlink" href="#finite-difference-approximations-for-the-second-derivative" title="Link to this heading">#</a></h3>
<p>To approximate the second derivative we allow ourselves to use all three values <span class="math notranslate nohighlight">\(F_{i+1}\)</span>, <span class="math notranslate nohighlight">\(F_i\)</span>, and <span class="math notranslate nohighlight">\(F_{i-1}\)</span>.  To find a combination that results in <span class="math notranslate nohighlight">\(F_i''\)</span>, we start by writing out their Taylor Series expansions around <span class="math notranslate nohighlight">\(x_i\)</span>:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
F_{i+1} &amp;= F_i + (\Delta x) F_i' + \frac{(\Delta x)^2}{2} F_i'' + \frac{(\Delta x)^3}{6} F_i''' + \frac{(\Delta x)^4}{24} F_i''''\\
F_i &amp;= F_i\\
F_{i-1} &amp;= F_i - (\Delta x) F_i' + \frac{(\Delta x)^2}{2} F_i'' - \frac{(\Delta x)^3}{6} F_i''' + \frac{(\Delta x)^4}{24} F_i''''
\end{align*}\]</div>
<p>If we add <span class="math notranslate nohighlight">\(F_{i+1}\)</span> and <span class="math notranslate nohighlight">\(F_{i-1}\)</span>, all of the odd terms will cancel.  We are left</p>
<div class="math notranslate nohighlight">
\[
F_{i+1} + F_{i-1} = 2 F_i + (\Delta x)^2 F_i'' + \frac{(\Delta x)^4}{12} F_i''''
\]</div>
<p>Subtracting <span class="math notranslate nohighlight">\(2F_i\)</span> from this and dividing by <span class="math notranslate nohighlight">\((\Delta x)^2\)</span> yields</p>
<div class="math notranslate nohighlight" id="equation-second-diff">
<span class="eqno">(1.4)<a class="headerlink" href="#equation-second-diff" title="Link to this equation">#</a></span>\[
\frac{F_{i+1}-2F_i + F_{i-1}}{(\Delta x)^2} = F_i'' + \mathcal{O}((\Delta x)^2)
\]</div>
</section>
</section>
<section id="returning-to-the-pde">
<h2><span class="section-number">1.3. </span>Returning to the PDE<a class="headerlink" href="#returning-to-the-pde" title="Link to this heading">#</a></h2>
<p>We are now ready to write out the equations for each (interior) grid point.  We have <span class="math notranslate nohighlight">\(u_t = K u_{xx}\)</span>.</p>
<p>At an interior point <span class="math notranslate nohighlight">\((x_i,t_j)\)</span>, we can approximate the <span class="math notranslate nohighlight">\(t\)</span> derivative using a forward difference.  For the <span class="math notranslate nohighlight">\(t\)</span> derivative, we treat <span class="math notranslate nohighlight">\(u\)</span> as a function of the single variable <span class="math notranslate nohighlight">\(t\)</span>, holding <span class="math notranslate nohighlight">\(x = x_i\)</span> fixed.</p>
<p>The derivative is found by subtracting the value of <span class="math notranslate nohighlight">\(u\)</span> at the grid point from the value of <span class="math notranslate nohighlight">\(u\)</span> at the next grid point in the <span class="math notranslate nohighlight">\(t\)</span> direction and dividing by <span class="math notranslate nohighlight">\(\Delta t\)</span>, following <a class="reference internal" href="#equation-forward-diff">(1.1)</a>:</p>
<div class="math notranslate nohighlight">
\[
u_t(x_i,t_j) = \frac{u_i^{j+1} - u_i^j}{\Delta t} + \mathcal{O}(\Delta t)
\]</div>
<p>Now we do the same for the second <span class="math notranslate nohighlight">\(x\)</span> derivative following <a class="reference internal" href="#equation-second-diff">(1.4)</a>.  This time we treat it as a function of the single variable <span class="math notranslate nohighlight">\(x\)</span>, holding <span class="math notranslate nohighlight">\(t=t_j\)</span> fixed.</p>
<div class="math notranslate nohighlight">
\[
u_{xx}(x_i, t_j) = \frac{u_{i+1}^j - 2 u_i^j + u_{i-1}^j}{(\Delta x)^2} +\mathcal{O}(\Delta x^2)
\]</div>
<p>As</p>
<div class="math notranslate nohighlight">
\[
u_{t} = K u_{xx}
\]</div>
<p>we conclude</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{u_i^{j+1} - u_i^j}{\Delta t} + \mathcal{O}(\Delta t) &amp;= K \left(\frac{u_{i+1}^j - 2 u_i^j + u_{i-1}^j}{(\Delta x)^2} +\mathcal{O}(\Delta x)^2\right)\\
u_i^{j+1} &amp;= u_i^j + \frac{\Delta t}{(\Delta x)^2} \left(u_{i+1}^j - 2 u_i^j + u_{i-1}^j\right) + \mathcal{O}(\Delta t (\Delta x)^2)
\end{align*}\]</div>
<p>Our initial condition gives us <span class="math notranslate nohighlight">\(u_i^0\)</span> for all <span class="math notranslate nohighlight">\(i=0,\ldots, N\)</span>.  From this and the equation above, we can deduce an approximation for <span class="math notranslate nohighlight">\(u_i^{1}\)</span> for all <span class="math notranslate nohighlight">\(i=1,\ldots, N-1\)</span>.  The boundary conditions give us the values for <span class="math notranslate nohighlight">\(i=0\)</span> and <span class="math notranslate nohighlight">\(i=N\)</span>.  Note that due to our constant boundary conditions, we can use the equation <span class="math notranslate nohighlight">\(u_0^1=u_0^0\)</span> and <span class="math notranslate nohighlight">\(u_N^1=u_N^0\)</span>.</p>
<p>Once we have <span class="math notranslate nohighlight">\(u_i^1\)</span> for all <span class="math notranslate nohighlight">\(i\)</span>, we can repeat, getting a new approximation for <span class="math notranslate nohighlight">\(u_i^2\)</span>.  Iterating forward we effectively implement Euler’s method in time.</p>
<p>For clarity, we will alter our notation to use <span class="math notranslate nohighlight">\(U_i^j\)</span> to represent the approximation to <span class="math notranslate nohighlight">\(u_i^j\)</span>.  For simplification, we will define <span class="math notranslate nohighlight">\(r=\Delta t/(\Delta x)^2\)</span>  We have (where missing entries in the matrix are all <span class="math notranslate nohighlight">\(0\)</span>)</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{pmatrix}
U_0^{j+1}\\
U_1^{j+1}\\
U_2^{j+1}\\
U_3^{j+1}\\
\vdots\\
\vdots\\
%U_{N-3}^{j+1}\\
U_{N-2}^{j+1}\\
U_{N-1}^{j+1}\\
U_N^{j+1}
\end{pmatrix}
=
\begin{pmatrix}
1 &amp; 0&amp; &amp; &amp;  &amp; &amp; &amp; &amp; &amp; \\
Kr &amp;1-2Kr &amp;Kr &amp; &amp; &amp; &amp;&amp; &amp; &amp; \\
&amp; Kr &amp;1-2Kr &amp;Kr &amp; &amp; &amp; &amp;  &amp; &amp; \\
 &amp; &amp; Kr &amp;1-2Kr &amp;Kr &amp;  &amp; &amp; &amp; &amp; \\
 &amp; &amp; &amp;  &amp; &amp; \ddots &amp; &amp; &amp; &amp; \\
 &amp; &amp; &amp;  &amp; \ddots &amp; \ddots &amp;   &amp; &amp;&amp;\\
 &amp;  &amp;  &amp;  &amp; &amp; Kr &amp;1-2Kr &amp; Kr &amp;  &amp; \\
 &amp;  &amp;  &amp;  &amp;    &amp;  &amp;Kr &amp;1-2r &amp; Kr &amp; \\
 &amp; &amp;&amp;&amp;  &amp; &amp; &amp;Kr &amp;1-2Kr &amp; Kr\\
 &amp;  &amp;  &amp;  &amp;   &amp;  &amp;  &amp; &amp;0 &amp; 1
\end{pmatrix}
\begin{pmatrix}
U_0^{j}\\
U_1^{j}\\
U_2^{j}\\
U_3^{j}\\
\vdots\\
\vdots\\
%U_{N-3}^{j}\\
U_{N-2}^{j}\\
U_{N-1}^{j}\\
U_N^{j}
\end{pmatrix}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="k">as</span> <span class="nn">la</span>

<span class="n">r</span><span class="o">=</span><span class="mi">20</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>

<span class="n">K</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">L</span><span class="o">=</span><span class="mi">5</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

<span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>  <span class="c1">#the full matrix A.  No attempt to treat it as a sparse matrix.</span>
<span class="k">for</span> <span class="n">counter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">counter</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">A</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="n">counter</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">A</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="n">counter</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span><span class="o">*</span><span class="n">r</span>
        <span class="n">A</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="n">counter</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">K</span><span class="o">*</span><span class="n">r</span>
        <span class="n">A</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span><span class="o">*</span><span class="n">r</span>


<span class="n">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">L</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">L</span><span class="p">)</span>
<span class="k">for</span> <span class="n">counter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)):</span>
    <span class="n">Z</span><span class="p">[</span><span class="n">counter</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">Z</span><span class="p">[</span><span class="n">counter</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Initial Condition&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="o">/</span><span class="n">dt</span><span class="p">),:],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$t=10$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">20</span><span class="o">/</span><span class="n">dt</span><span class="p">),:],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$t=20$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">30</span><span class="o">/</span><span class="n">dt</span><span class="p">),:],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$t=30$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">40</span><span class="o">/</span><span class="n">dt</span><span class="p">),:],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$t=40$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">50</span><span class="o">/</span><span class="n">dt</span><span class="p">),:],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$t=50$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Z</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">/</span><span class="n">dt</span><span class="p">),:],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$t=100$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$U(x,t)$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">MemoryError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">line</span> <span class="mi">14</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">14</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>  <span class="c1">#the full matrix A.  No attempt to treat it as a sparse matrix.</span>

<span class="nn">File c:\Users\JCMiller\AppData\Local\Programs\Python\Python313\Lib\site-packages\numpy\lib\_function_base_impl.py:5263,</span> in <span class="ni">meshgrid</span><span class="nt">(copy, sparse, indexing, *xi)</span>
<span class="g g-Whitespace">   </span><span class="mi">5260</span>     <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="o">*</span><span class="n">output</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5262</span> <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">5263</span>     <span class="n">output</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5265</span> <span class="k">return</span> <span class="n">output</span>

<span class="nn">File c:\Users\JCMiller\AppData\Local\Programs\Python\Python313\Lib\site-packages\numpy\lib\_function_base_impl.py:5263,</span> in <span class="ni">&lt;genexpr&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">   </span><span class="mi">5260</span>     <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="o">*</span><span class="n">output</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5262</span> <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">5263</span>     <span class="n">output</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5265</span> <span class="k">return</span> <span class="n">output</span>

<span class="ne">MemoryError</span>: Unable to allocate 186. GiB for an array with shape (5000002, 5001) and data type float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="practice-problems">
<h2><span class="section-number">1.4. </span>Practice Problems<a class="headerlink" href="#practice-problems" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Measure the runtime as <span class="math notranslate nohighlight">\(\Delta x\)</span> shrinks.  Plot on a log-log scale.  Explain the scaling.  (you may want to read up on <code class="docutils literal notranslate"><span class="pre">timeit</span></code> in python.)</p></li>
<li><p>The true solution to the differential equation is <span class="math notranslate nohighlight">\(100 x/L + 100 \sin(4 \pi x/L) e^{-K(4 \pi/L)^2t}\)</span>.  Take the solution at <span class="math notranslate nohighlight">\(t=10\)</span> calculate for different values of <span class="math notranslate nohighlight">\(\Delta x\)</span>.  Subtract the true solution to get the error.  Plot the <span class="math notranslate nohighlight">\(\ell^2\)</span> norm of the error as a function of <span class="math notranslate nohighlight">\(\Delta x\)</span>.</p></li>
<li><p>Modify the calculation to take an initial condition of <span class="math notranslate nohighlight">\(u(x,0) = \frac{100x}{L} + 100\sin\left(\frac{\pi x}{L} \right))\)</span>.  Compare how quickly the solution approaches the final steady state.</p></li>
<li><p>Modify the calculation to solve <span class="math notranslate nohighlight">\(u_t = K u_{xx} + u_x\)</span>.  Ensure that it remains second order accurate in <span class="math notranslate nohighlight">\(x\)</span>.</p></li>
<li><p>The model above is one we know how to solve analytically.  However, small changes can turn it into something that we cannot easily solve analytically (or perhaps not at all).  Assume the rod has varying properties so that <span class="math notranslate nohighlight">\(K = 1+ sin(x\pi/L)\)</span>. Update the algorithm and solve this.</p></li>
<li><p>Continuing the problem above, think about what would happen if <span class="math notranslate nohighlight">\(K\)</span> has very sharp changes near a few values of <span class="math notranslate nohighlight">\(x\)</span>.  Explain why this might require small values of <span class="math notranslate nohighlight">\(\Delta x\)</span> near those changes.  If we use small <span class="math notranslate nohighlight">\(\Delta x\)</span> everywhere, this puts a lot of computational effort where not much is happening.If we had variable size <span class="math notranslate nohighlight">\(\Delta x\)</span>, what would go wrong with our current approach?</p></li>
<li><p>Using the original calculation, increase <span class="math notranslate nohighlight">\(r = \Delta t/(\Delta x)^2\)</span>.  You should see something unusual happen for large enough <span class="math notranslate nohighlight">\(r\)</span>.  Note that <span class="math notranslate nohighlight">\(r\)</span> appears only in the product <span class="math notranslate nohighlight">\(Kr\)</span>.  Can you determine the value of <span class="math notranslate nohighlight">\(Kr\)</span> at which the unusual behavior begins (it may help to increase the maximum <span class="math notranslate nohighlight">\(t\)</span> close to the threshold)? Calculate, by hand, what would happen just above this threshod if the vector of <span class="math notranslate nohighlight">\(U_i^j\)</span> had a long sequence of entries <span class="math notranslate nohighlight">\(\ldots, a, -a, a, -a, a, -a, \ldots\)</span> in the middle.</p></li>
<li><p>If the end at <span class="math notranslate nohighlight">\(x=L\)</span> is insulated, the appropriate boundary condition is <span class="math notranslate nohighlight">\(u_x(L,t)=0\)</span>.  One way to impose this is that <span class="math notranslate nohighlight">\(U_N^{j+1} = U_{N-1}^{j+1}\)</span>.  What is the order of accuracy of this approximation?  How could you modify the matrix <span class="math notranslate nohighlight">\(A\)</span> to impose this condition?</p></li>
<li><p>Consider Laplace’s equation <span class="math notranslate nohighlight">\(u_{xx} + u_{yy} = 0\)</span> in <span class="math notranslate nohighlight">\([-L,L] \times [-L,L]\)</span>.  Set the boundary conditions to be <span class="math notranslate nohighlight">\(u(-L,y)=0\)</span>,  <span class="math notranslate nohighlight">\(u(L,y)=0\)</span>, <span class="math notranslate nohighlight">\(u(x,-L) = x^2-L^2\)</span> and <span class="math notranslate nohighlight">\(u(x,L) = L^2-x^2\)</span>.  Use a similar approach with <span class="math notranslate nohighlight">\(-L \leq x_i \leq L\)</span> and <span class="math notranslate nohighlight">\(-L \leq y_j \leq L\)</span> to express <span class="math notranslate nohighlight">\(u_{xx}(x_i,y_j) + u_{yy}(x_i,y_j)\)</span> for interior points.  Identify an appropriate matrix equation.  If you are familiar with the methods, attempt to solve this equation numerically.</p></li>
<li><p>Modify the algorithm above to use the <code class="docutils literal notranslate"><span class="pre">scipy.linalg.solve_banded</span></code> algorithm.  Compare the run times.</p></li>
<li><p>Find another combination of <span class="math notranslate nohighlight">\(F_{i+1}\)</span>, <span class="math notranslate nohighlight">\(F_i\)</span>, and <span class="math notranslate nohighlight">\(F_{i-1}\)</span> that gives an approximation to <span class="math notranslate nohighlight">\(F_i'\)</span>, or prove there is none.</p></li>
<li><p>Find an approximation to <span class="math notranslate nohighlight">\(F_i''\)</span> using <span class="math notranslate nohighlight">\(F_i\)</span>, <span class="math notranslate nohighlight">\(F_{i+1}\)</span> and <span class="math notranslate nohighlight">\(F_{i+2}\)</span>.  What order accuracy is it?</p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "joelmiller/FiniteDiff",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Numerical Methods for PDEs</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretizing-space">1.1. Discretizing space</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-differences">1.2. Finite Differences</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-difference-approximations-for-the-first-derivative">1.2.1. Finite Difference Approximations for the First derivative</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-difference">1.2.1.1. Forward difference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-difference">1.2.1.2. Backward Difference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#central-difference">1.2.1.3. Central difference</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-difference-approximations-for-the-second-derivative">1.2.2. Finite Difference Approximations for the Second derivative</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#returning-to-the-pde">1.3. Returning to the PDE</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practice-problems">1.4. Practice Problems</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Joel Miller
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>